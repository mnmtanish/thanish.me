_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[38],{Ltlh:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2021-01-24-multiplayer-tetris-game-part-2/embed/finished",function(){return r("swPC")}])},ODXe:function(t,e,r){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(l){o=!0,a=l}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return r}}(t,e)||function(t,e){if(t){if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.d(e,"a",(function(){return o}))},Qetd:function(t,e,r){"use strict";var n=Object.assign.bind(Object);t.exports=n,t.exports.default=t.exports},swPC:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return g}));var n=r("ODXe"),o=r("o0o1"),a=r.n(o),i=r("nKUr"),u=r("q1tI");function l(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var c=[[[1,1],[1,1]],[[1,0,0],[1,1,1]],[[0,1,0],[1,1,1]],[[1,1,1]]],y={moveLeft:function(t){t.x--},moveRight:function(t){t.x++},moveDown:function(t){t.y++},rotateShape:function(t){for(var e=[],r=0;r<t.type[0].length;++r){e[r]=[];for(var n=0;n<t.type.length;++n)e[r][n]=t.type[t.type.length-1-n][r]}t.type=e}},d=1,v=2,h=3,s=function(t,e,r,n,o){for(var a=["#6fa8dc","#f6b26b"],i=t.length,u=[],l=[],f=function(){e(u)},s=function(t){var e=Math.floor(Math.random()*c.length),r={x:0,y:0,type:c[e],color:"#111"};r.x=Math.floor(o.worldWidth/i/2*(2*t+1)-1),r.y=-r.type.length,r.color=a[t%a.length],u[t].unshift(r),f()},p=function(t,e){var r=u[t][0],o=Object.create(r);e(o);for(var a=0;a<n.length;++a){var i=(0,n[a])(o,r,u);if(i===d)return;if(i===v)return void s(t);i===h&&(alert("GAME OVER!"),g())}e(r),f()},w=r((function(){for(var t=0;t<u.length;++t)p(t,y.moveDown)})),g=function(){w(),l.forEach((function(t){return t()}))},b=0;b<i;++b)u[b]=[],s(b);for(var m=function(e){var r=t[e];l[e]=function(t,e){var r=function(r){for(var n=0,o=Object.keys(t);n<o.length;n++){var a=o[n];if(r.code===a){e(t[a]);break}}};return document.addEventListener("keydown",r),function(){document.removeEventListener("keydown",r)}}(r,(function(t){return p(e,t)}))},x=0;x<i;++x)m(x);return g},p=[{KeyW:y.rotateShape,KeyA:y.moveLeft,KeyS:y.moveDown,KeyD:y.moveRight},{ArrowUp:y.rotateShape,ArrowLeft:y.moveLeft,ArrowDown:y.moveDown,ArrowRight:y.moveRight}],w={worldWidth:16,worldHeight:16,worldScale:25};function g(){var t=Object(u.useRef)(null);return Object(u.useEffect)((function(){if(t){var e=function(t,e){var r=e.worldWidth*e.worldScale,n=e.worldHeight*e.worldScale;t.width=r,t.height=n;var o=t.getContext("2d"),a=function(t){o.save(),o.translate(t.x*e.worldScale,t.y*e.worldScale);for(var r=0;r<t.type.length;++r)for(var n=t.type[r],a=0;a<n.length;++a)n[a]&&(i=a,u=r,l=t.color,o.fillStyle=l,o.strokeStyle="#000",o.fillRect(i*e.worldScale,u*e.worldScale,e.worldScale,e.worldScale),o.strokeRect(i*e.worldScale,u*e.worldScale,e.worldScale,e.worldScale));var i,u,l;o.restore()};return function(t){o.clearRect(0,0,r,n);for(var e=0;e<t.length;++e)for(var i=t[e],u=0;u<i.length;++u)a(i[u])}}(t.current,w),r=(i=500,function(t){var e=!0;return setTimeout((function r(){e&&(t(),setTimeout(r,i))}),i),function(){e=!1}}),o=function(t){var e=function(t,e){return!(t.x>e.x+e.type[0].length||t.x+t.type[0].length<e.x||t.y>e.y+e.type.length||t.y+t.type.length<e.y)},r=function(t,e,r,n){if(!t.type[e][r])return!1;var o=e+t.y-n.y,a=r+t.x-n.x;return!(!n.type[o]||!n.type[o][a])},o=a.a.mark((function t(e,r){var n,o,i,u;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<r.length)){t.next=16;break}o=r[n],i=0;case 4:if(!(i<o.length)){t.next=13;break}if((u=o[i])!==e){t.next=8;break}return t.abrupt("continue",10);case 8:return t.next=10,[u,0===i];case 10:++i,t.next=4;break;case 13:++n,t.next=1;break;case 16:case"end":return t.stop()}}),t)}));return[function(t,a,i){if(t.type===a.type&&t.x>=a.x)return null;if(t.x<0)return d;var u,f=l(o(a,i));try{for(f.s();!(u=f.n()).done;){var c=Object(n.a)(u.value,1)[0];if(e(t,c))for(var y=0;y<t.type.length;++y)if(r(t,y,0,c))return d}}catch(v){f.e(v)}finally{f.f()}return null},function(a,i,u){if(a.type===i.type&&a.x<=i.x)return null;if(a.x+a.type[0].length>t.worldWidth)return d;var f,c=l(o(i,u));try{for(c.s();!(f=c.n()).done;){var y=Object(n.a)(f.value,1)[0];if(e(a,y))for(var v=a.type[0].length-1,h=0;h<a.type.length;++h)if(r(a,h,v,y))return d}}catch(s){c.e(s)}finally{c.f()}return null},function(a,i,u){if(a.type===i.type&&a.y<=i.y)return null;if(a.y+a.type.length>t.worldHeight)return v;var f,c=l(o(i,u));try{for(c.s();!(f=c.n()).done;){var y=Object(n.a)(f.value,2),s=y[0],p=y[1];if(e(a,s))for(var w=0;w<a.type[0].length;++w)for(var g=0,b=a.type.length-1;b>=0;--b){var m=a.type[b][w];if(m&&!g&&r(a,b,w,s))return a.y<=0?h:p?d:v;g=m}}}catch(x){c.e(x)}finally{c.f()}return null}]}(w);s(p,e,r,o,w)}var i}),[t]),Object(i.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",background:"#ddd"},children:Object(i.jsx)("canvas",{ref:t,style:{display:"block",margin:"0 auto",background:"#fff"}})})}}},[["Ltlh",0,1,3]]]);