<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Thanish.me - Multiplayer Tetris Game</title><meta name="description" content="A tutorial about writing a multiplayer game from scratch. Starting from solidifying the requirements and continues all the way up to creating a working prototype."/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/21dfc3f4812a1fc8e4c0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/21dfc3f4812a1fc8e4c0.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-32dd6c3cc9c48ef79ec5.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.cdbdac0a36200f52203c.js" as="script"/><link rel="preload" href="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.920dbe403c5a8541bbb1.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-b6c115db7faaa0ad7b9c.js" as="script"/><link rel="preload" href="/_next/static/chunks/593d174140e2013aafef88d14920b52dbff37f03.5f6cc9d8c94809d7f6c5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/2020-12-13-multiplayer-tetris-game-d82260eed474e85fd8be.js" as="script"/></head><body><div id="__next"><main><content class="markdown-body"><article><main><h1>Multiplayer Tetris Game</h1><p>I just wanted to see what it would look like if multiple players try to play Tetris on the same canvas. Let&#x27;s build this game in multiple rounds where the result of each iteration is a playable game.</p><img src="/_next/static/images/1a44a319f1728cbd6fa1a9832c415ce6.png" width="1000" height="700" alt="Tetris game concept"/><p>These are our requirements for version 1:</p><ul><li>it should be possible for multiple players to play the game</li><li>it should support all the basic rules of a &quot;Tetris&quot; like game</li></ul><p>This is what we&#x27;re NOT doing for version 1:</p><ul><li>avoid support for playing with multiple devices, create a split-screen multiplayer game</li><li>avoid support for mobile devices, touch controls, etc.</li></ul><h2>Basic Components</h2><p>Before building, let&#x27;s list down all the basic components. If we get this good enough, it may survive this version and some future versions of this game.</p><img src="/_next/static/images/b18f86c32c28d07a727d3ceeb07b69a8.png" width="1000" height="400" alt="Basic components of the game"/><p>And we also need to define some rules to determine how it should behave. We may change these later but having some at the beginning makes it easy to develop.</p><ul><li>All shapes in the game world must be visible on the screen.</li><li>Shapes must not overlap with other shapes in the game world.</li><li>When the game clock ticks, active shapes will move downwards. If they cannot move downwards they will become inactive.</li><li>Players can move their active shapes left, right or rotate them using actions but only if there is enough empty space.</li></ul><p>I guess that&#x27;s enough to get us started. Let&#x27;s convert what we have designed so far to code to see if it all makes any sense.</p><h2>Writing the code</h2><p>Let&#x27;s start with a list of shape types. We can represent each shape type as a 2D array. The &#x27;1&#x27;s represent filled blocks and the &#x27;0&#x27;s will represent holes.</p><pre><code class="language-js">const SHAPE_TYPES = [
  [
    [1, 1],
    [1, 1],
  ],
];
</code></pre><p>On the other end, we have the player. The most important thing we need from a player is to listen to actions from the player. So what are these actions? let&#x27;s define actions as simple functions which manipulate the active shape. For example, the moveLeft and moveRight functions will modify the &#x27;x&#x27; position of the shape.</p><pre><code class="language-js">const ACTION_TYPES = {
  moveLeft: (shape) =&gt; {
    shape.x--;
  },

  moveRight: (shape) =&gt; {
    shape.x++;
  },
};
</code></pre><p>The player holds a listener function and calls it when the user performs certain actions. We will require a listener function and a map of keycode to action functions.</p><pre><code class="language-js">const startPlayer = (keymap, listener) =&gt; {
  document.addEventListener(&#x27;keydown&#x27;, (e) =&gt; {
    for (const key of Object.keys(keymap)) {
      if (e.code === key) {
        listener(keymap[key]);
        break;
      }
    }
  });
};
</code></pre><p>We don&#x27;t even have a game to play with but we already have some technical debt :D. Let&#x27;s clean it up just to keep things clean.</p><pre><code class="language-js">// the returned function must be called to destroy the player
const startPlayer = (keymap, listener) =&gt; {
  const keyDownListener = (e) =&gt; {
    for (const key of Object.keys(keymap)) {
      if (e.code === key) {
        listener(keymap[key]);
        break;
      }
    }
  };
  document.addEventListener(&#x27;keydown&#x27;, keyDownListener);

  return () =&gt; {
    document.removeEventListener(&#x27;keydown&#x27;, keyDownListener);
  };
};
</code></pre><p>And next, the game world. It will bring all the players and the shapes together and renders the output using the given renderer.</p><pre><code class="language-js">const startWorld = (keymaps, renderer) =&gt; {
  const playerActionListener = (i, action) =&gt; {
    // TODO: apply action on the active shape
  };
  const stopPlayerFunctions = [];
  for (let i = 0; i &lt; keymaps.length; ++i) {
    const keymap = keymaps[i];
    const listener = (action) =&gt; playerActionListener(i, action);
    stopPlayerFunctions[i] = startPlayer(keymap, listener);
  }

  return () =&gt; {
    stopPlayerFunctions.forEach((fn) =&gt; fn());
  };
};
</code></pre></main></article></content></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/2020-12-13-multiplayer-tetris-game","query":{},"buildId":"7NAjlWTah5wVzdBgz4IhB","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-11c8eba6a84e3fddec04.js"></script><script src="/_next/static/chunks/main-32dd6c3cc9c48ef79ec5.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.cdbdac0a36200f52203c.js" async=""></script><script src="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.920dbe403c5a8541bbb1.js" async=""></script><script src="/_next/static/chunks/pages/_app-b6c115db7faaa0ad7b9c.js" async=""></script><script src="/_next/static/chunks/593d174140e2013aafef88d14920b52dbff37f03.5f6cc9d8c94809d7f6c5.js" async=""></script><script src="/_next/static/chunks/pages/blog/2020-12-13-multiplayer-tetris-game-d82260eed474e85fd8be.js" async=""></script><script src="/_next/static/7NAjlWTah5wVzdBgz4IhB/_buildManifest.js" async=""></script><script src="/_next/static/7NAjlWTah5wVzdBgz4IhB/_ssgManifest.js" async=""></script></body></html>