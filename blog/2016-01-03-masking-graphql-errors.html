<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Thanish.me - Masking GraphQL Errors</title><meta name="description" content="The way **graphql-js** and **express-graphql** handle errors is has some issues. Consider this example server which has a bug in a resolve function."/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/e9e02a87a4c5bda8b576.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e9e02a87a4c5bda8b576.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-45110e586e5b9bc00f35.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.cdbdac0a36200f52203c.js" as="script"/><link rel="preload" href="/_next/static/chunks/afe4269f325c6b8604421e2a8f7bec7a7b2019c2.6c26eafa6145d614ef25.js" as="script"/><link rel="preload" href="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.4a5474eceaa2247b7ab4.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-054f777325865917245d.js" as="script"/><link rel="preload" href="/_next/static/chunks/ec66151a9e4e24d8cdbbe349a286441475ff64c5.2f985208f1a91fdb0020.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/2016-01-03-masking-graphql-errors-2812eb9361a7a3807490.js" as="script"/></head><body><div id="__next"><main><content class="markdown-body"><article><header id="navbar"><a id="link-home" href="/"><img src="/logo-192.png" alt="Homepage" width="48px" height="48px"/></a></header><header><h1>Masking GraphQL Errors</h1><p class="post-meta"><small>Posted on <!-- -->2016-01-03</small></p><main><section><p>The way **graphql-js** and **express-graphql** handle errors is has some issues. Consider this example server which has a bug in a resolve function.</p></section></main></header><main><p>The way <strong>graphql-js</strong> and <strong>express-graphql</strong> handle errors is has some issues. Consider this example server which has a bug in a resolve function.</p><p>When the query “{ users }” is executed, the server will respond with the error message “User.find is not a function”. There are several problems with this behavior:</p><h3>[ 1 ]<!-- --> Error stacktraces are hidden</h3><p>When developing the application or when running it in production error stack traces are extremely useful to pinpoint issues. But when errors occur inside resolve functions, they are not logged on the server.</p><h3>[ 2 ]<!-- --> Server source code get exposed</h3><p>Error messages may have parts of the source code in it. When running the above example server, with the error message alone it is visible that the server program tries to call a <strong>find</strong> method on a variable called <strong>User</strong>. With this knowledge, it’s possible to make good assumptions about the server.</p><p>{{&lt; figure src=&quot;/imported/1-9WYx0Ntr0C87KhY-gMgEFg.png&quot; &gt;}}</p><h3>[ 3 ]<!-- --> Users get cryptic error messages</h3><p>Error messages automatically sent to the user are often not consumer friendly. It would have been more useful if the user received an error message like “An unexpected error has occurred. Please report to <a href="mailto:errors@mydomain.com">errors@mydomain.com</a>” instead of “User.find is not a function”.</p><hr/><p>To avoid these issues, errors happening inside resolve functions must be processed before sending them to the client. Unless changes are made to graphql-js these errors must be handled inside resolve functions or after completely processing the query. Both approaches have limitations.</p><p>There are quite a few <a href="https://github.com/graphql/graphql-js/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+is%3Aopen+error">open issues</a> on the graphql-js Github repo related to error handling, most of them can be handled by:</p><ol><li>Logging all error messages and stacks on the server.</li><li>Allowing the user to control errors sent to the client.</li></ol><h2><strong>Enter graphql-errors</strong></h2><p>The <strong>graphql-errors</strong> node module attempts to solve these issue by masking errors sent to users and logging errors on the server. Instead of sending the real error message, it sends a simple error message “Internal Error”. This protects the server source code from leaking out. It also logs error messages on the server with stacktraces.</p><p>{{&lt; figure src=&quot;/imported/1-MwdytBP91MwjN6m7IKMjRA.png&quot; &gt;}}</p><p>Fields, types or schemas can be processed to behave this way using the <strong>maskErrors</strong> function. If it’s necessary to handle errors in a different way, it can be done easily using the <strong>setDefaultHandler</strong> function or by giving an error handler function as the second argument for <strong>maskErrors</strong>.</p><h3>Custom Error Messages</h3><p>It is also a good practice to send user friendly error messages to the client. This can be done by using a special <strong>UserError</strong> type. When a <strong>UserError</strong> is thrown inside a resolve function, it will be sent to the user.</p><hr/><blockquote><p>For the <a href="https://github.com/kadirahq/meteor-graphql">Meteor GraphQL</a> support, we are using a slightly <a href="https://github.com/kadirahq/meteor-graphql/pull/6">different approach</a> and using Meteor’s <strong>Meteor.Error</strong> instead of <strong>UserError.</strong></p></blockquote><p>You can find the <strong>graphql-errors</strong> module on Github (<a href="https://github.com/kadirahq/graphql-errors">kadirahq/graphql-errors</a>) with more information. If you wish to join the discussion about whether custom error types should be a part of GraphQL, checkout this <a href="https://github.com/facebook/graphql/issues/135">Github Issue</a>.</p></main></article></content></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/2016-01-03-masking-graphql-errors","query":{},"buildId":"cMZ193JEUBCd4etmp-2xq","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-4f07b0c20fc9b3d5aa59.js"></script><script src="/_next/static/chunks/main-45110e586e5b9bc00f35.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.cdbdac0a36200f52203c.js" async=""></script><script src="/_next/static/chunks/afe4269f325c6b8604421e2a8f7bec7a7b2019c2.6c26eafa6145d614ef25.js" async=""></script><script src="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.4a5474eceaa2247b7ab4.js" async=""></script><script src="/_next/static/chunks/pages/_app-054f777325865917245d.js" async=""></script><script src="/_next/static/chunks/ec66151a9e4e24d8cdbbe349a286441475ff64c5.2f985208f1a91fdb0020.js" async=""></script><script src="/_next/static/chunks/pages/blog/2016-01-03-masking-graphql-errors-2812eb9361a7a3807490.js" async=""></script><script src="/_next/static/cMZ193JEUBCd4etmp-2xq/_buildManifest.js" async=""></script><script src="/_next/static/cMZ193JEUBCd4etmp-2xq/_ssgManifest.js" async=""></script></body></html>