<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Thanish.me - FabricJS performance hack</title><meta name="description" content="The frame rate can be improved by only rendering inside a rAF callback."/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/7f70020d85390dd3a34d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7f70020d85390dd3a34d.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-45110e586e5b9bc00f35.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.cdbdac0a36200f52203c.js" as="script"/><link rel="preload" href="/_next/static/chunks/afe4269f325c6b8604421e2a8f7bec7a7b2019c2.6c26eafa6145d614ef25.js" as="script"/><link rel="preload" href="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.4a5474eceaa2247b7ab4.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-f02ce07924e8fedfef57.js" as="script"/><link rel="preload" href="/_next/static/chunks/ec66151a9e4e24d8cdbbe349a286441475ff64c5.7ffadac7dd0f7e019b2c.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/2017-05-17-fabricjs-performance-hack-01abf5726c7875fe9d8c.js" as="script"/></head><body><div id="__next"><main class="markdown-body"><article><header class="page-header"><a href="/" class="page-header-title">Thanish.me</a><a href="/" class="page-header-subtitle">dd if=/dev/head of=/dev/blog</a></header><header><h1 class="post-head">FabricJS performance hack</h1><p class="post-meta"><small>Posted on <!-- -->2017-05-17</small></p><main><section><p>The frame rate can be improved by only rendering inside a rAF callback.</p></section></main></header><main><p>The frame rate can be improved by only rendering inside a rAF callback.</p><pre><code class="language-js">let isRendering = false;
let isAnimating = false;

const render = canvas.renderAll.bind(canvas);
const stop = () =&gt; isAnimating = false;
const play = () =&gt; {
    isAnimating = true;
    canvas.renderAll();
};

canvas.renderAll = () =&gt; {
    if (!isRendering) {
        isRendering = true;
        requestAnimationFrame(() =&gt; {
            render();
            isRendering = false;
            if (isAnimating) {
                canvas.renderAll();
            }
        });
    }
};
</code></pre><p>I started working with FabricJS this week so there’s a big chance things might break. I couldn’t find any place this might break after going through the canvas.renderAll method source code but this needs more tests before it can be used in any project. Here’s screenshots of profiles before and after applying the hack on an example scene.</p><img src="/_next/static/images/776027c2baebc19cb03f8ffa19ddad5b.png" alt="Screenshot of the profile before applying the hack"/><img src="/_next/static/images/88758f6fe2e021007bd3f8a5ba6d35e0.png" alt="Screenshot of the profile after applying the hack"/><p>The frame rate can be improved further by running requestAnimationFrame in a loop ( example: using the play function in the gist ).</p><p>{{&lt; figure src=&quot;/imported/1-3Wu64u6UyaUPH7NIxJtC6A.png&quot; &gt;}}</p><p>Even if this hack works, you’ll need to do customize the hack depending on your application. Like I said, I’ve only started using FabricJS this week so if there’s something wrong with the code, please let me know with a comment.</p></main></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/2017-05-17-fabricjs-performance-hack","query":{},"buildId":"xQ9F5DGep0bEZ6xm9hk0A","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-4f07b0c20fc9b3d5aa59.js"></script><script src="/_next/static/chunks/main-45110e586e5b9bc00f35.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.cdbdac0a36200f52203c.js" async=""></script><script src="/_next/static/chunks/afe4269f325c6b8604421e2a8f7bec7a7b2019c2.6c26eafa6145d614ef25.js" async=""></script><script src="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.4a5474eceaa2247b7ab4.js" async=""></script><script src="/_next/static/chunks/pages/_app-f02ce07924e8fedfef57.js" async=""></script><script src="/_next/static/chunks/ec66151a9e4e24d8cdbbe349a286441475ff64c5.7ffadac7dd0f7e019b2c.js" async=""></script><script src="/_next/static/chunks/pages/blog/2017-05-17-fabricjs-performance-hack-01abf5726c7875fe9d8c.js" async=""></script><script src="/_next/static/xQ9F5DGep0bEZ6xm9hk0A/_buildManifest.js" async=""></script><script src="/_next/static/xQ9F5DGep0bEZ6xm9hk0A/_ssgManifest.js" async=""></script></body></html>