<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Thanish.me - Elastic Iframes</title><meta name="description" content="Sometimes it become necessary to use iframes when building some web  applications. Often we have them hidden but sometimes iframes can be  useful visible too."/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/f2de525f08037cbc6b9e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f2de525f08037cbc6b9e.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" as="script"/><link rel="preload" href="/_next/static/chunks/afe4269f325c6b8604421e2a8f7bec7a7b2019c2.e5ebd9a9dc48937a5931.js" as="script"/><link rel="preload" href="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.75924e07078b24214e9e.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-e37b7be6f8e64920e240.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-ca60ee2a73a7be766260.js" as="script"/><link rel="preload" href="/_next/static/chunks/ec66151a9e4e24d8cdbbe349a286441475ff64c5.35a602b2b7b41dfb8d3c.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/2014-03-29-elastic-iframes-6d18c368c6cd76bbf017.js" as="script"/></head><body><div id="__next"><main class="markdown-body"><article><header class="page-header"><a href="/" class="page-header-title">Thanish.me</a><a href="/" class="page-header-subtitle">dd if=/dev/head of=/dev/blog</a></header><header><h1 class="post-head">Elastic Iframes</h1><p class="post-meta"><small>Posted on <!-- -->2014-03-29</small></p><main><section><p>Sometimes it become necessary to use iframes when building some web  applications. Often we have them hidden but sometimes iframes can be  useful visible too.</p></section></main></header><main><p>Sometimes it become necessary to use iframes when building some web  applications. Often we have them hidden but sometimes iframes can be  useful visible too.</p><p>For Node Knockout 2013, I was working with Meteorhacks on <a href="meteorhacks.2013.nodeknockout.com">Open  Comment Box</a>. It’s like a self-hosted  Disqus alternative. We kept the comments view inside an iframe to make  sure it doesn’t clash with main website styles and for security reasons.  The comment system is real-time. So, comments visible changes  frequently and it required the iframe containing these comments to  resize in order to avoid scrollbars.</p><p>If we’re on the same origin, one of the things we can do is to continually check if the <strong>scrollHeight</strong> of the child frame document body changes and update the iframe height.</p><pre><code class="language-js">(function (iframe) {

    var prevHeight = null;

    setInterval(function () {
        if(prevHeight!==iframe.contentDocument.body.scrollHeight){
            prevHeight = iframe.contentDocument.body.scrollHeight;
            iframe.style.height = prevHeight + &#x27;px&#x27;;
        }
    });

})(document.getElementById(&#x27;iframe&#x27;));

</code></pre><p>Because of security approaches taken by modern web browsers, this  will not work if you have the iframe and parent window in different  origins. This is a security enhancement, not a bug so can’t much expect  it to get <em>fixed</em> in the future.</p><p>If pages belong to different origins the parent window is not allowed to access information about content inside the iframe. <strong>I’ll be spooked out of my skin if it can and definitely avoid using such a web browser</strong>.</p><p>As a cross-origin solution, what we can do is to move the function  which tracks height changes to the page loaded inside the iframe (<em>Assuming you can control both parent and child frame pages</em>). And use <strong>postMessage</strong> to update the height on parent window. To keep things more interesting  I’m going to use mozilla jschannel to organize postMessage messages.</p><p>First, include jschannel by adding this script tag to both pages (parent window and page inside iframe).</p><pre><code class="language-html">&lt;script src=&quot;//cdnjs.cloudflare.com/ajax/libs/jschannel/1.0.0-git-commit1-8c4f7eb/jschannel.min.js&quot;&gt;&lt;/script&gt;

</code></pre><p>And this snippet inside the child frame page scripts which creates  the jschannel, detects changes to body height and sends messages to the  parent page via jschannel.</p><pre><code class="language-js">(function () {

  function DO_NOTHING () {}

  var channel = null;
  var prevHeight = null;

  document.addEventListener(&#x27;DOMContentLoaded&#x27;, function () {
    channel = Channel.build({
       window: window.parent
      ,origin: &#x27;*&#x27;
      ,scope: &#x27;test_scope&#x27;
    });
    setInterval(watchDocumentHeight, 250);
  })

  function watchDocumentHeight() {
    if (prevHeight !== document.body.scrollHeight) {
      channel.call({
         method: &#x27;resize&#x27;
        ,params: document.body.scrollHeight
        ,success: DO_NOTHING
      });
      prevHeight = document.body.scrollHeight;
    }
  }

})();


</code></pre><p>And this one inside the parent page scripts to prepare the jschannel, wait for messages and update the height.</p><pre><code class="language-js">(function (iframe) {

  var channel = null;

  document.addEventListener(&#x27;DOMContentLoaded&#x27;, function () {
    channel = Channel.build({
       window: iframe.contentWindow
      ,origin: &#x27;*&#x27;
      ,scope: &#x27;test_scope&#x27;
      ,onReady: onChannelReady
    });
  })

  function onChannelReady () {
    channel.bind(&#x27;resize&#x27;, onResize);
  }

  function onResize (trans, data) {
    iframe.style.height = data + &#x27;px&#x27;;
  }

})(document.getElementById(&#x27;iframe&#x27;));

</code></pre><p>Is this all really necessary? We can make the code much shorter if we  use window.postMessage directly but if you’re using iframes, most  probably you’ll need to use if for more than changing the height.  Mozilla jschannel can help you when it comes to organizing postMessage  channels.</p><p>Original Post: <a href="https://mnmtanish.svbtle.com/elastic-iframes-autogrow-height">https://mnmtanish.svbtle.com/elastic-iframes-autogrow-height</a></p></main></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/2014-03-29-elastic-iframes","query":{},"buildId":"LBoss_3bTEnpbr99JDv_S","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-e479c6e9625ada71bd60.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" async=""></script><script src="/_next/static/chunks/afe4269f325c6b8604421e2a8f7bec7a7b2019c2.e5ebd9a9dc48937a5931.js" async=""></script><script src="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.75924e07078b24214e9e.js" async=""></script><script src="/_next/static/chunks/main-e37b7be6f8e64920e240.js" async=""></script><script src="/_next/static/chunks/pages/_app-ca60ee2a73a7be766260.js" async=""></script><script src="/_next/static/chunks/ec66151a9e4e24d8cdbbe349a286441475ff64c5.35a602b2b7b41dfb8d3c.js" async=""></script><script src="/_next/static/chunks/pages/blog/2014-03-29-elastic-iframes-6d18c368c6cd76bbf017.js" async=""></script><script src="/_next/static/LBoss_3bTEnpbr99JDv_S/_buildManifest.js" async=""></script><script src="/_next/static/LBoss_3bTEnpbr99JDv_S/_ssgManifest.js" async=""></script></body></html>