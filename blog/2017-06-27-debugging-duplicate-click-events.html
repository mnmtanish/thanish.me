<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Thanish.me - Duplicate click events</title><meta name="description" content="While trying to debug this issue, we found out a couple of interesting things about how Angular manages event handlers."/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/f2de525f08037cbc6b9e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f2de525f08037cbc6b9e.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" as="script"/><link rel="preload" href="/_next/static/chunks/afe4269f325c6b8604421e2a8f7bec7a7b2019c2.e5ebd9a9dc48937a5931.js" as="script"/><link rel="preload" href="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.75924e07078b24214e9e.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-e37b7be6f8e64920e240.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-ca60ee2a73a7be766260.js" as="script"/><link rel="preload" href="/_next/static/chunks/ec66151a9e4e24d8cdbbe349a286441475ff64c5.35a602b2b7b41dfb8d3c.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/2017-06-27-debugging-duplicate-click-events-a525bf9b8828cadad959.js" as="script"/></head><body><div id="__next"><main class="markdown-body"><article><header class="page-header"><a href="/" class="page-header-title">Thanish.me</a><a href="/" class="page-header-subtitle">dd if=/dev/head of=/dev/blog</a></header><header><h1 class="post-head">Duplicate click events</h1><p class="post-meta"><small>Posted on <!-- -->2017-06-27</small></p><main><section><p>While trying to debug this issue, we found out a couple of interesting things about how Angular manages event handlers.</p></section></main></header><main><p>While trying to debug this issue, we found out a couple of interesting things about how Angular manages event handlers.</p><p>The double click event bug can be recreated easily with the following <a href="https://github.com/mnmtanish/test-ng-event">example app</a>. The important parts are:</p><p>The “click” Output of the button component:</p><pre><code>&lt;button (click)=&quot;clicked($event)&quot;&gt;
  &lt;ng-content&gt;&lt;/ng-content&gt;
&lt;/button&gt;

export class TestButtonComponent implements OnInit {
  @Output() click: EventEmitter&lt;MouseEvent&gt;;

  clicked(e: MouseEvent) {
    console.log(&#x27;TestButtonComponent: clicked!&#x27;);
    this.click.emit(e)
  }

  ...
}
</code></pre><p>and the code which listens to the event:</p><pre><code>&lt;app-test-button (click)=&quot;clicked($event)&quot;&gt;
  Test Button
&lt;/app-test-button&gt;

export class AppComponent {
  clicked(e: MouseEvent) {
    console.log(&#x27;AppComponent: clicked!&#x27;);
  }
}
</code></pre><p>When we ran the app with a similar code, the “TestButtonComponent: clicked!” text gets logged once as expected but the “AppComponent: clicked!” text gets logged twice.</p><p>Let’s add a breakpoint on the AppComponent click event handler.</p><img src="/_next/static/images/82356975194fadf815f70d938f035571.png" alt="Screenshot taken during the second click event emit with the stack trace"/><p>If we analyze <a href="https://github.com/mnmtanish/test-ng-event">stack traces</a> on the event handler, we can see that the events are originating from different sources.</p><ol><li><code>&lt;button&gt;.click</code> → <code>TestButtonComponent.click</code> → !</li><li><code>&lt;app-test-button&gt;.click</code> → !</li></ol><p>This brings us to research on how Angular binds to events on components. The first event listed above was easy to reason about as it is what we were expecting in our example. The “click” DOM event on the button element fires the “click” Output which calls the event handler.</p><p>The second event on the other hand is created from a DOM event on the component element. This event listener is created by the <a href="https://github.com/angular/angular/blob/5293794316cc1b0f57d5d88b3fefdf6ae29d0d97/packages/platform-browser/src/dom/events/dom_events.ts">DomEventsPlugin</a> on the Angular <a href="https://github.com/angular/angular/blob/5293794316cc1b0f57d5d88b3fefdf6ae29d0d97/packages/platform-browser/src/dom/events/event_manager.ts">EventManager</a>. (If we use event names handled by HammerJS such as “tap” or “pinch” the <a href="https://github.com/angular/angular/blob/5293794316cc1b0f57d5d88b3fefdf6ae29d0d97/packages/platform-browser/src/dom/events/hammer_gestures.ts">HammerGesturesPlugin</a> will be used.)</p><blockquote><p>This means that all custom events used throughout the app also has event listeners on the DOM with that name on each component.</p></blockquote><p>Angular will use the DomEventsPlugin for ALL event names if no other plugins support that event. This means that all custom events used throughout the app also has event listeners on the DOM with that name on each component. This can be confirmed using Chrome developer tools.</p><img src="/_next/static/images/b858952fbaa5b938ebff482c98693c7b.png" alt="Screenshot of the list of event listeners on the app-test-button element"/><p>It requires more experiments to check the performance impact on the app caused because of this approach. But the point I like to emphasize here is that when using events in Angular, it is important to be aware of this in order to avoid any unexpected behavior.</p><p>To learn more about the Angular EventManager, I highly recommend taking 5 minutes to go through <a href="https://github.com/angular/angular/tree/5293794316cc1b0f57d5d88b3fefdf6ae29d0d97/packages/platform-browser/src/dom/events">the source code</a>. Also check this <a href="https://medium.com/@TheLarkInn/hacking-angular2-binding-multiple-dom-events-f781b14ef676">blog post</a> about writing custom EventManagerPlugins.</p><p><strong>Edit:</strong> fixed a mistake in the example code about related to event bubbling.</p></main></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/2017-06-27-debugging-duplicate-click-events","query":{},"buildId":"LBoss_3bTEnpbr99JDv_S","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-e479c6e9625ada71bd60.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" async=""></script><script src="/_next/static/chunks/afe4269f325c6b8604421e2a8f7bec7a7b2019c2.e5ebd9a9dc48937a5931.js" async=""></script><script src="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.75924e07078b24214e9e.js" async=""></script><script src="/_next/static/chunks/main-e37b7be6f8e64920e240.js" async=""></script><script src="/_next/static/chunks/pages/_app-ca60ee2a73a7be766260.js" async=""></script><script src="/_next/static/chunks/ec66151a9e4e24d8cdbbe349a286441475ff64c5.35a602b2b7b41dfb8d3c.js" async=""></script><script src="/_next/static/chunks/pages/blog/2017-06-27-debugging-duplicate-click-events-a525bf9b8828cadad959.js" async=""></script><script src="/_next/static/LBoss_3bTEnpbr99JDv_S/_buildManifest.js" async=""></script><script src="/_next/static/LBoss_3bTEnpbr99JDv_S/_ssgManifest.js" async=""></script></body></html>